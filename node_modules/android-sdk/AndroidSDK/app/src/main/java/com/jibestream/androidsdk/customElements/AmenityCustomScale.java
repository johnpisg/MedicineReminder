package com.jibestream.androidsdk.customElements;

import android.graphics.Matrix;

import com.jibestream.jibestreamandroidlibrary.main.Camera;
import com.jibestream.jibestreamandroidlibrary.main.M;

/**
 * Created by emmanuel on 15-07-05.
 */
public class AmenityCustomScale extends com.jibestream.jibestreamandroidlibrary.elements.Amenity {

public AmenityCustomScale() {
  super();
  setHeadsUp(true);
  getTransform().setScale(0.5f);
//  setOffsetY(-15);
//  setBoundingBoxVisible(true);
}

//@Override
//public void onCreate(Context context, M m, long timeElapsed, long timeTotal, Camera camera) {
//  super.onCreate(context, m, timeElapsed, timeTotal, camera);
//
//  transform.setTranslationOffsetX(transform.getTranslationX());
//  transform.setTranslationOffsetY(transform.getTranslationY());
//  transform.setTranslationX(0);
//  transform.setTranslationY(0);
//}


private final float[] matrixArray = new float[9];

@Override
public void onPreRender(M m, long timeElapsed, long timeTotal, int fps, Camera camera) {
  super.onPreRender(m, timeElapsed, timeTotal, fps, camera);
  if (getDirtyTransform() || camera.isTransformationDirty()) {
    float cameraScale = camera.getScale();
    float cameraRec = 1f / cameraScale;
    float zoomThreshold = 2f;
    if (cameraRec > zoomThreshold) {
      final Matrix transformation = getTransformation();
      transformation.getValues(matrixArray);
      float x = matrixArray[Matrix.MTRANS_X];
      float y = matrixArray[Matrix.MTRANS_Y];
      transformation.postScale(cameraScale, cameraScale, x, y);
      transformation.postScale(zoomThreshold, zoomThreshold, x, y);
    }
  }
}
}
