package com.jibestream.jibestreamandroidlibrary.mapBuilderV3.textDirections.filter;

import com.jibestream.jibestreamandroidlibrary.mapBuilderV3.textDirections.TDInstruction;

/**
 * Created by frankduffy on 2016-01-27.
 */
public class EndAsLandmark {

    public void endAsLandmark(TDFilterInput inst) {
        if(inst.useArrayOfFloorWaypoints == inst.wayfindArray[inst.wayfindArray.length-1]) {
            // This is the last floor
            TDInstruction lastDirection = inst.textDirectionsFloorArray.get(inst.textDirectionsFloorArray.size()-1);
            if((lastDirection != null) && (lastDirection.destination != null)) {
                // Still looking
                boolean foundIt = false;
                int firstIndex = 0;

                for(int i = 0; i < inst.textDirectionsFloorArray.size(); i++) {
                    TDInstruction nextDirection = inst.textDirectionsFloorArray.get(i);
                    // Ignore first direction--it could be a mover
                    if (nextDirection != inst.textDirectionsFloorArray.get(0)) {
                        // Match?
                        // Same Landmark
                        if (lastDirection.destination != null && nextDirection.landmarkDestination != null) {
                            if (nextDirection.landmarkDestination.id == lastDirection.destination.id) {
                                // Got it
                                foundIt = true;
                                // Break
                                break;
                            }
                        }
                    }

                    firstIndex++;
                }

                if(foundIt) {
                    int loopTo = inst.textDirectionsFloorArray.size() - 1;
                    for(int i = (loopTo-1); i >=firstIndex; i--) {
                        // Fold second last
                        TDInstruction foldDirection = inst.textDirectionsFloorArray.get(i);
                        // Carry last direction behind you
                        lastDirection.foldToBack(foldDirection);
                        // Same, remove it
                        inst.textDirectionsFloorArray.remove(i);
                    }
                }
            }
        }
    }
}